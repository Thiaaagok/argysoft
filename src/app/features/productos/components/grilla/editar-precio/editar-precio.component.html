<div class="card">
    <form #form="ngForm" novalidate class="grid-formulario">
        <div class="flex flex-col grow basis-0 gap-2 mb-2">
            <div class="mb-2 flex">
                <label>Precio Anterior:</label>
                @if(parametro.Tipo == 'COMPRA'){
                <span class="font-bold">{{ productoEditar.PrecioCompra| currency:'ARS':'symbol' }}</span>
                }@else if(parametro.Tipo == 'VENTA'){
                <span class="font-bold">{{ productoEditar.PrecioVenta| currency:'ARS':'symbol' }}</span>
                }
            </div>
            <p-floatlabel variant="in">
                <p-inputnumber id="barcode" class="w-100" [(ngModel)]="nuevoPrecio" name="precioCompra"
                    id="precioCompra" [showButtons]="true" inputId="stacked" mode="currency" currency="ARG" />
                <label for="precioCompra">Nuevo Precio {{ parametro.Tipo.charAt(0) +
                    parametro.Tipo.slice(1).toLowerCase() }}</label>
            </p-floatlabel>
        </div>
    </form>
    <div class="card">
        <div class="font-semibold text-xl mb-4">Anteriores Actualizaciones</div>
        <p-table #grillaProductos [value]="registrosAnteriores" dataKey="Id" [rows]="10" [loading]="cargando"
            [rowHover]="true" [showGridlines]="true" [paginator]="true" [globalFilterFields]="[]"
            responsiveLayout="scroll">
            <ng-template #header>
                <tr>
                    <th>
                        <div class="flex justify-between items-center">
                            Precio Anterior
                        </div>
                    </th>
                    <th>
                        <div class="flex justify-between items-center">
                            Precio Actualizado
                        </div>
                    </th>
                    <th>
                        <div class="flex justify-between items-center">
                            Fecha
                        </div>
                    </th>
                    <th>
                        <div class="flex justify-between items-center">
                            %
                        </div>
                    </th>
                </tr>
            </ng-template>

            @if(!cargando){
            <ng-template #body let-registro>
                <tr class="cursor-pointer">
                    <td>{{ registro.PrecioAnterior | currency:'ARS':'symbol'}}</td>
                    <td>{{ registro.PrecioNuevo | currency:'ARS':'symbol'}}</td>
                    <td>{{ registro.FechaActualizacion | date: 'dd/MM/yyyy HH:mm'}}</td>
                    <td>
                        <span
                            [ngClass]="{'text-green-600': registro.Porcentaje > 0, 'text-red-600': registro.Porcentaje < 0}">
                            <i *ngIf="registro.Porcentaje > 0" class="pi pi-arrow-up"></i>
                            <i *ngIf="registro.Porcentaje < 0" class="pi pi-arrow-down"></i>
                            {{ registro.Porcentaje | number:'1.2-2' }}%
                        </span>
                    </td>
                </tr>
            </ng-template>
            }
            <ng-template #emptymessage>
                <tr>
                    <td colspan="8">No se encontraron actualizaciones previas.</td>
                </tr>
            </ng-template>
            <ng-template #loadingbody>
                <tr>
                    <td colspan="8">Cargando actualizaciones...</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    <div class="col-span-full flex justify-end gap-2 pt-4">
        <p-button label="Cancelar" icon="pi pi-times" class="p-button-outlined" [disabled]="cargando"
            (click)="cerrar()"></p-button>

        <p-button label="Guardar" severity="success" icon="pi pi-check" (click)="onSubmit()"
            [disabled]="!form.valid || cargando">
        </p-button>
    </div>
</div>