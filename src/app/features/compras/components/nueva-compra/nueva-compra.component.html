<div class="botonera-flotante">
    <div class="botonera-contenedor">
        <button mat-mini-fab color="primary" matTooltip="Crear una nueva compra" (click)="onSubmit()">
            <i class="fa-solid fa-square-plus"></i>
        </button>
    </div>
</div>
<div class="card">
    <div class="font-semibold text-xl mb-4">Nueva Compra</div>
    <p-table #grillaCompras [value]="nuevaCompra.Items" dataKey="Id" [rows]="10" [loading]="cargando" [rowHover]="true"
        [showGridlines]="true" [paginator]="true"
        [globalFilterFields]="['Producto.Nombre', 'Proveedor.Nombre', 'Cantidad', 'PrecioUnitario', 'Subtotal']"
        responsiveLayout="scroll">

        <ng-template #caption>
            <form #form="ngForm">
                <div class="flex flex-wrap items-center gap-2">
                    <div class="flex flex-col w-20 gap-0">
                        <app-select-chosen title="Producto" [(ngModel)]="nuevoItem.Producto" name="producto"
                            placeholder="Producto" [dataSource]="productosCombo" (ngModelChange)="productoSeleccionadoEvent($event)" [required]="true"
                            (recargar)="cargarProductosCombo()">
                        </app-select-chosen>
                    </div>
                    <div class="flex flex-col w-20 gap-0">
                        <app-select-chosen title="Proveedor" [(ngModel)]="nuevoItem.Proveedor" name="proveedor"
                            placeholder="Proveedor" [dataSource]="proveedoresCombo">
                        </app-select-chosen>
                    </div>
                    <div class="flex flex-col gap-0">
                        <p-floatlabel variant="in">
                            <p-inputnumber [(ngModel)]="nuevoItem.Cantidad" name="cantidad" inputId="cantidad"
                                [showButtons]="true" mode="decimal" [required]="true" [min]="1" />
                            <label for="cantidad">Cantidad</label>
                        </p-floatlabel>
                    </div>
                </div>
            </form>
            <div class="flex flex-wrap items-center gap-2">
                <p-button label="Nuevo item" [disabled]=" !nuevoItem.Cantidad ||nuevoItem.Cantidad <= 0" class="mt-2"
                    icon="pi pi-plus-circle" (click)="crearNuevoItem()" />
            </div>
        </ng-template>

        <ng-template #header>
            <tr>
                <th>
                    <div class="flex justify-between items-center">
                        Producto
                        <p-columnFilter type="text" field="Producto.Nombre" display="menu"></p-columnFilter>
                    </div>
                </th>
                <th>
                    <div class="flex justify-between items-center">
                        Proveedor
                        <p-columnFilter type="text" field="Proveedor.Nombre" display="menu"></p-columnFilter>
                    </div>
                </th>
                <th>
                    <div class="flex justify-between items-center">
                        Cantidad
                    </div>
                </th>
                <th>
                    <div class="flex justify-between items-center">
                        Precio Unitario
                    </div>
                </th>
                <th>
                    <div class="flex justify-between items-center">
                        Subtotal

                    </div>
                </th>
            </tr>
        </ng-template>

        <ng-template #body let-compraItem>
            <tr (click)="editarItem(compraItem.Id)" class="cursor-pointer">
                <td>{{ compraItem.Producto?.Nombre }}</td>
                <td>{{ compraItem.Proveedor?.Descripcion }}</td>
                <td>{{ compraItem.Cantidad }}</td>
                <td>{{ compraItem.Producto.PrecioCompra | currency:'ARS':'symbol' }}</td>
                <td>{{ compraItem.Subtotal | currency:'ARS':'symbol' }}</td>
            </tr>
        </ng-template>

        <ng-template #emptymessage>
            <tr>
                <td colspan="5">No se encontraron ítems de compra.</td>
            </tr>
        </ng-template>

        <ng-template #loadingbody>
            <tr>
                <td colspan="5">Cargando ítems de compra...</td>
            </tr>
        </ng-template>
    </p-table>
</div>